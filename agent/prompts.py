from __future__ import annotations

from langchain_core.prompts import ChatPromptTemplate

# Промпт для определения интентов
INTENT_PROMPT = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            (
                "Ты определяешь интенты пользователя из списка: search, summarize, sentiment, none. "
                "Интерпретируй так:\n"
                "- search: просят найти свежие сведения, новости, последние/новые данные, информацию из интернета; без поиска ответ неочевиден.\n"
                "- summarize: явно просят пересказать/кратко изложить текст или результаты поиска.\n"
                "- sentiment: явно просят оценить тональность текста.\n"
                "- none: если явных запросов на поиск/пересказ/тональность нет или можно ответить напрямую.\n"
                "Верни ответ строго как JSON-массив строк, без текста вокруг. Примеры:\n"
                "  \"Найди последние новости о X\" -> [\"search\", \"summarize\"]\n"
                "  \"Какие последние новости о X?\" -> [\"search\", \"summarize\"]\n"
                "  \"Найди новости о X и перескажи\" -> [\"search\", \"summarize\"]\n"
                "  \"Определи тональность текста ...\" -> [\"sentiment\"]\n"
                "  \"Сколько будет 2+2?\" -> [\"none\"]"
            ),
        ),
        ("user", "{user_query}"),
    ]
)

# Промпт для псевдо-поиска
SEARCH_PROMPT = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            (
                "Сымитируй результаты поиска в интернете. "
                "Сгенерируй 3-5 правдоподобных, но фейковых результатов: "
                "заголовок, url, краткий snippet. Не придумывай прямой ответ, "
                "а именно имитируй выдачу. Пиши по-русски."
            ),
        ),
        ("user", "Запрос: {query}"),
    ]
)

# Промпт для суммаризации результатов поиска
SUMMARY_PROMPT = ChatPromptTemplate.from_template(
    "У тебя список результатов поиска (заголовок, URL и сниппет). "
    "Сформулируй 3-5 фактических тезисов по содержанию сниппетов на русском языке, "
    "переформулируй, не повторяй заголовки. Если сведений мало, коротко скажи об этом.\n"
    "{content}"
)

# Промпт для тональности
SENTIMENT_PROMPT = ChatPromptTemplate.from_template(
    "Определи тональность (позитив/негатив/нейтрально) и кратко обоснуй:\n{content}"
)

# Промпт для fallback
FALLBACK_PROMPT = ChatPromptTemplate.from_messages(
    [
        ("system", "Ответь на запрос пользователя кратко и по существу."),
        ("user", "{query}"),
    ]
)
