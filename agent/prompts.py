from __future__ import annotations

from langchain_core.prompts import ChatPromptTemplate

# Промпт для определения интентов
INTENT_PROMPT = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            (
                "Ты определяешь интенты пользователя из списка: search, summarize, sentiment, none. "
                "Интерпретируй так:\n"
                "- search: просят найти свежие сведения, новости, последние/новые данные, информацию из интернета; без поиска ответ неочевиден.\n"
                "- summarize: явно просят пересказать/кратко изложить текст или результаты поиска.\n"
                "- sentiment: явно просят оценить тональность текста.\n"
                "- none: если явных запросов на поиск/пересказ/тональность нет или можно ответить напрямую.\n"
                "Верни ответ строго как JSON-массив строк, без текста вокруг. Примеры:\n"
                "  \"Найди последние новости о X\" -> [\"search\", \"summarize\"]\n"
                "  \"Какие последние новости о X?\" -> [\"search\", \"summarize\"]\n"
                "  \"Найди новости о X и перескажи\" -> [\"search\", \"summarize\"]\n"
                "  \"Определи тональность текста ...\" -> [\"sentiment\"]\n"
                "  \"Сколько будет 2+2?\" -> [\"none\"]\n"
                "  \"Найди статьи про Москвариум и оцени их тональность\" -> [\"search\", \"sentiment\"]\n"
                "  \"Перескажи этот текст\" -> [\"summarize\"]\n"
                "  \"Поясни, что такое градиентный бустинг\" -> [\"none\"]"
            ),
        ),
        ("user", "{user_query}"),
    ]
)

# Промпт для псевдо-поиска
SEARCH_PROMPT = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            (
                "Сымитируй результаты поиска в интернете. "
                "Сгенерируй 3-5 правдоподобных, но фейковых результатов: "
                "заголовок, url, краткий snippet. Не придумывай прямой ответ, "
                "а именно имитируй выдачу. Пиши по-русски. Избегай повторов заголовков.\n"
                "Пример:\n"
                "- Исследование влияния кофеина на сон (https://example.com/coffee-sleep): Кратко о том, как кофе влияет на длительность и глубину сна.\n"
                "- Учёные сравнили эффекты кофе и чая на сон (https://example.com/tea-vs-coffee): Результаты эксперимента на 200 участниках."
            ),
        ),
        ("user", "Запрос: {query}"),
    ]
)

# Промпт для суммаризации результатов поиска
SUMMARY_PROMPT = ChatPromptTemplate.from_template(
    "У тебя список результатов поиска (заголовок, URL и сниппет). "
    "Сформулируй 3-4 разных фактических тезиса по содержанию сниппетов на русском языке, "
    "переформулируй, не повторяй заголовки и не дублируй тезисы. "
    "Если сведений мало, дай 1-2 уникальных тезиса и прямо скажи, что данных мало.\n"
    "Пример ответа:\n"
    "1) Кофеин укорачивает общее время сна, но повышает долю глубокого сна.\n"
    "2) Эффект кофеина зависит от времени приёма и чувствительности человека.\n"
    "3) В ряде исследований данные противоречивы; требуется учёт дозировки.\n"
    "{content}"
)

# Промпт для тональности
SENTIMENT_PROMPT = ChatPromptTemplate.from_template(
    "Определи тональность текста.\n"
    "- Если в запросе одна реплика, верни общую тональность: `<тональность>: <краткое обоснование>`.\n"
    "- Если в запросе несколько реплик (напр. несколько фраз в кавычках или через запятую), оцени каждую отдельно и верни список строк:\n"
    "  - \"<реплика>\": <тональность> (<краткое обоснование>)\n"
    "Не добавляй заголовков и лишнего текста.\n"
    "Примеры:\n"
    "- Вопрос: \"Сервис отличный\" -> позитив: явная положительная оценка сервиса.\n"
    "- Вопрос: \"Поддержка не отвечает неделями\" -> негатив: подчёркивается плохой опыт поддержки.\n"
    "- Вопрос: \"Игра выглядит красиво, но управление хромает\" -> нейтрально: похвала визуалу компенсирована критикой управления.\n"
    "- Вопрос: \"\"Сервис отличный\" и \"Поддержка не отвечает неделями\"\" ->\n"
    "  - \"Сервис отличный\": позитив (прямая похвала сервиса)\n"
    "  - \"Поддержка не отвечает неделями\": негатив (жалоба на поддержку)\n"
    "{content}"
)

# Промпт для fallback
FALLBACK_PROMPT = ChatPromptTemplate.from_messages(
    [
        ("system", "Ответь на запрос пользователя кратко и по существу."),
        ("user", "{query}"),
    ]
)
